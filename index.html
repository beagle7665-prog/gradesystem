<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>班級成績管理與分析系統 (繽紛版)</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- SheetJS (xlsx) for Excel Export/Import -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js"></script>

    <!-- FontAwesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        body {
            background-color: #fffbeb; /* 暖色背景 */
            font-family: 'Noto Sans TC', sans-serif;
            overflow-x: hidden;
        }
        
        /* Decorative Background Shapes */
        .bg-shape {
            position: fixed;
            z-index: -1;
            opacity: 0.6;
        }
        .shape-1 {
            top: -100px;
            right: -50px;
            width: 400px;
            height: 400px;
            background: radial-gradient(circle, #fcd34d 0%, rgba(255,255,255,0) 70%);
            border-radius: 50%;
            filter: blur(40px);
        }
        .shape-2 {
            bottom: -50px;
            left: -100px;
            width: 500px;
            height: 500px;
            background: radial-gradient(circle, #fda4af 0%, rgba(255,255,255,0) 70%);
            border-radius: 50%;
            filter: blur(50px);
        }

        .table-container::-webkit-scrollbar {
            height: 12px;
            width: 12px;
        }
        .table-container::-webkit-scrollbar-track {
            background: #fdf6e3; 
            border-radius: 6px;
        }
        .table-container::-webkit-scrollbar-thumb {
            background: #fca5a5; 
            border-radius: 6px;
            border: 3px solid #fdf6e3;
        }
        .table-container::-webkit-scrollbar-thumb:hover {
            background: #f87171; 
        }
        
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { 
            -webkit-appearance: none; 
            margin: 0; 
        }
        
        .empty-grade {
            background-color: #fff7ed;
            border: 2px dashed #fdba74;
            transition: all 0.2s;
        }
        .empty-grade:focus {
            background-color: #ffffff;
            border: 2px solid #f97316;
            box-shadow: 0 0 0 3px rgba(249, 115, 22, 0.2);
            z-index: 10;
        }

        /* Focus state for text inputs to match the grid navigation feel */
        input[type="text"]:focus {
            background-color: #ffffff;
            border: 2px solid #f97316;
            box-shadow: 0 0 0 3px rgba(249, 115, 22, 0.2);
            z-index: 10;
        }
        
        .tab-active {
            background: linear-gradient(135deg, #f97316 0%, #ea580c 100%);
            color: white;
            border-color: transparent;
            box-shadow: 0 4px 6px -1px rgba(234, 88, 12, 0.3);
            transform: translateY(-1px);
        }
        .tab-inactive {
            background-color: #fff7ed;
            color: #9a3412;
            border-color: #fed7aa;
        }
        .tab-inactive:hover {
            background-color: #ffedd5;
            color: #ea580c;
        }
        
        /* Loading Overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            color: #d97706;
        }
        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #fed7aa;
            border-top: 5px solid #f97316;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 1rem;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Rank Effects */
        .rank-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .rank-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
        }
        .rank-1 {
            background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%);
            border: 2px solid #fbbf24;
            position: relative;
            overflow: hidden;
        }
        .rank-1::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(251, 191, 36, 0.1) 0%, transparent 60%);
            animation: rotate 10s linear infinite;
        }
        @keyframes rotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        
        .rank-2 {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border: 2px solid #94a3b8;
        }
        .rank-3 {
            background: linear-gradient(135deg, #fff7ed 0%, #ffedd5 100%);
            border: 2px solid #fdba74;
        }
        
        @keyframes bounce-gentle {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        .crown-icon {
            animation: bounce-gentle 2s infinite;
        }

        /* Delete column button */
        .delete-col-btn {
            opacity: 0;
            transition: opacity 0.2s;
        }
        th:hover .delete-col-btn {
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="bg-shape shape-1"></div>
    <div class="bg-shape shape-2"></div>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        const INITIAL_HEADERS = Array.from({ length: 20 }, (_, i) => `項目${i + 1}`);
        const STORAGE_KEY = "grade_system_v2_data"; 

        const RANGES = [
            { label: "100分", check: (s) => s === 100, color: "bg-rose-500" },
            { label: "90-99分", check: (s) => s >= 90 && s < 100, color: "bg-orange-500" },
            { label: "80-89分", check: (s) => s >= 80 && s < 90, color: "bg-amber-400" },
            { label: "70-79分", check: (s) => s >= 70 && s < 80, color: "bg-yellow-400" },
            { label: "60-69分", check: (s) => s >= 60 && s < 70, color: "bg-lime-500" },
            { label: "60分以下", check: (s) => s < 60, color: "bg-gray-400" },
        ];

        // Cute Empty State Component
        const EmptyState = ({ message, action, actionText }) => (
            <div className="flex flex-col items-center justify-center py-12 text-center w-full">
                <div className="bg-orange-100 p-6 rounded-full mb-4 shadow-sm">
                    {/* Simple SVG Illustration */}
                    <svg width="60" height="60" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M9 13H15M9 17H13M3 7V19C3 20.1046 3.89543 21 5 21H19C20.1046 21 21 20.1046 21 19V7M3 7H21M3 7V5C3 3.89543 3.89543 3 5 3H9L11 5H19C20.1046 5 21 5.89543 21 7" stroke="#f97316" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>
                    </svg>
                </div>
                <h3 className="text-xl font-bold text-gray-700 mb-2">這裡空空的</h3>
                <p className="text-gray-500 mb-6 max-w-sm">{message}</p>
                {action && (
                    <button onClick={action} className="bg-orange-500 hover:bg-orange-600 text-white font-bold py-2 px-6 rounded-full shadow-lg transform transition hover:scale-105 active:scale-95">
                        <i className="fa-solid fa-plus mr-2"></i>{actionText}
                    </button>
                )}
            </div>
        );

        function App() {
            const [students, setStudents] = useState([]);
            const [headers, setHeaders] = useState(INITIAL_HEADERS);
            const [customClasses, setCustomClasses] = useState([]); 
            const [activeTab, setActiveTab] = useState('input');
            const [selectedStatItem, setSelectedStatItem] = useState(0);
            const [editingHeader, setEditingHeader] = useState(null);
            const [currentClassView, setCurrentClassView] = useState("All");
            const [isLoading, setIsLoading] = useState(true);
            
            // Focus Management
            const [pendingFocus, setPendingFocus] = useState(null); // { rowIndex, colIndex }

            const fileInputRef = useRef(null);

            useEffect(() => {
                const savedData = localStorage.getItem(STORAGE_KEY);
                if (savedData) {
                    try {
                        const parsed = JSON.parse(savedData);
                        setStudents(parsed.students || []);
                        setHeaders(parsed.headers || INITIAL_HEADERS);
                        setCustomClasses(parsed.customClasses || []);
                    } catch (e) {
                        console.error("讀取儲存資料失敗", e);
                        setStudents([{ id: 1, className: "101", number: "01", name: "範例學生", grades: Array(20).fill("") }]);
                    }
                } else {
                    setStudents([{ id: 1, className: "101", number: "01", name: "範例學生", grades: Array(20).fill("") }]);
                }
                setIsLoading(false);
            }, []);

            useEffect(() => {
                if (!isLoading) {
                    const dataToSave = { students, headers, customClasses };
                    localStorage.setItem(STORAGE_KEY, JSON.stringify(dataToSave));
                }
            }, [students, headers, customClasses, isLoading]);

            // Auto-focus effect when pendingFocus changes
            useEffect(() => {
                if (pendingFocus) {
                    const { rowIndex, colIndex } = pendingFocus;
                    // Timeout to ensure DOM is ready after React render
                    setTimeout(() => {
                        const el = document.getElementById(`cell-${rowIndex}-${colIndex}`);
                        if (el) {
                            el.focus();
                            // Optional: Select all content
                            // el.select(); 
                        }
                    }, 0);
                    setPendingFocus(null);
                }
            }, [pendingFocus, students]);

            const availableClasses = useMemo(() => {
                const existingClasses = [...new Set(students.map(s => s.className || "未分類"))];
                const all = [...new Set([...existingClasses, ...customClasses])];
                return all.filter(c => c).sort((a, b) => a.localeCompare(b, undefined, { numeric: true }));
            }, [students, customClasses]);

            const displayedStudents = useMemo(() => {
                let filtered = students;
                if (currentClassView !== "All") {
                    filtered = students.filter(s => (s.className || "未分類") === currentClassView);
                }
                return filtered.sort((a, b) => {
                    const numA = parseInt(a.number) || 999;
                    const numB = parseInt(b.number) || 999;
                    return numA - numB;
                });
            }, [students, currentClassView]);

            const classRankings = useMemo(() => {
                const rankings = availableClasses.map(cls => {
                    const classStudents = students.filter(s => (s.className || "未分類") === cls);
                    const gradeIndex = selectedStatItem;
                    if (gradeIndex >= headers.length) return { className: cls, avg: -1, count: 0 };

                    const validGrades = classStudents
                        .map(s => s.grades[gradeIndex])
                        .filter(g => g !== "" && g !== null && g !== undefined);
                    
                    const total = validGrades.reduce((a, b) => a + b, 0);
                    const avg = validGrades.length > 0 ? (total / validGrades.length) : -1;

                    return { className: cls, avg: parseFloat(avg.toFixed(2)), count: validGrades.length };
                });
                return rankings.filter(r => r.avg >= 0).sort((a, b) => b.avg - a.avg);
            }, [students, availableClasses, selectedStatItem, headers]);

            const addStudent = (focusTargetRowIndex = null, focusTargetColIndex = null) => {
                const newId = students.length > 0 ? Math.max(...students.map(s => s.id)) + 1 : 1;
                let targetClass = "101";
                if (currentClassView !== "All") targetClass = currentClassView;
                else if (students.length > 0) targetClass = students[students.length - 1].className;
                
                const classStudents = students.filter(s => (s.className || "未分類") === targetClass);
                let nextNum = "";
                if (classStudents.length > 0) {
                    const maxNum = Math.max(...classStudents.map(s => parseInt(s.number) || 0));
                    if(maxNum > 0) nextNum = (maxNum + 1).toString().padStart(2, '0');
                }

                setStudents(prev => [...prev, { id: newId, className: targetClass, number: nextNum, name: "", grades: Array(headers.length).fill("") }]);

                if (focusTargetRowIndex !== null && focusTargetColIndex !== null) {
                    setPendingFocus({ rowIndex: focusTargetRowIndex, colIndex: focusTargetColIndex });
                }
            };

            // --- KEYBOARD NAVIGATION LOGIC ---
            const handleKeyDown = (e, rowIndex, colIndex) => {
                const totalRows = displayedStudents.length;
                // Col 0=Class, 1=Num, 2=Name, 3...=Grades
                // Max col index is 2 + headers.length
                const maxColIndex = 2 + headers.length; 

                const moveFocus = (r, c) => {
                    const targetId = `cell-${r}-${c}`;
                    const el = document.getElementById(targetId);
                    if (el) {
                        el.focus();
                        // Optional: auto-select text
                        // setTimeout(() => el.select(), 0); 
                    }
                };

                switch(e.key) {
                    case 'Enter':
                        e.preventDefault();
                        if (rowIndex === totalRows - 1) {
                            // Last row, add new student and focus same col in new row
                            addStudent(rowIndex + 1, colIndex);
                        } else {
                            moveFocus(rowIndex + 1, colIndex);
                        }
                        break;
                    case 'ArrowDown':
                        e.preventDefault();
                        if (rowIndex < totalRows - 1) {
                            moveFocus(rowIndex + 1, colIndex);
                        }
                        break;
                    case 'ArrowUp':
                        e.preventDefault();
                        if (rowIndex > 0) {
                            moveFocus(rowIndex - 1, colIndex);
                        }
                        break;
                    case 'ArrowLeft':
                        // Only move if cursor is at start or input is empty or it is a number input
                        // e.target.type check ensures we don't block text selection
                        const isText = e.target.type === 'text';
                        const isStart = e.target.selectionStart === 0 && e.target.selectionEnd === 0;
                        if (!isText || isStart) {
                            if (colIndex > 0) {
                                e.preventDefault();
                                moveFocus(rowIndex, colIndex - 1);
                            }
                        }
                        break;
                    case 'ArrowRight':
                        const valLen = e.target.value.toString().length;
                        const isEnd = e.target.selectionStart === valLen;
                        // Use !isText for number inputs which might not support selectionStart uniformly across browsers, 
                        // but here we just check generally.
                        if (e.target.selectionStart === null || isEnd) {
                            if (colIndex < maxColIndex) {
                                e.preventDefault();
                                moveFocus(rowIndex, colIndex + 1);
                            }
                        }
                        break;
                    default:
                        break;
                }
            };

            const handleAddClassTab = () => {
                const newClass = prompt("請輸入新班級名稱：");
                if (newClass && newClass.trim() !== "") {
                    const trimmedClass = newClass.trim();
                    if (availableClasses.includes(trimmedClass)) {
                        alert(`「${trimmedClass}」班級已經存在，已為您切換至該分頁。`);
                        setCurrentClassView(trimmedClass);
                        return;
                    }
                    setCustomClasses(prev => [...prev, trimmedClass]);
                    setCurrentClassView(trimmedClass);
                }
            };

            // Headers Management
            const removeHeader = (index) => {
                if (headers.length <= 1) {
                    alert("至少保留一個項目！");
                    return;
                }
                if (confirm(`確定刪除「${headers[index]}」嗎？\n這將刪除所有學生該項目的成績，無法復原！`)) {
                    setHeaders(prev => prev.filter((_, i) => i !== index));
                    setStudents(prev => prev.map(s => ({
                        ...s,
                        grades: s.grades.filter((_, i) => i !== index)
                    })));
                    if (selectedStatItem >= index && selectedStatItem > 0) {
                        setSelectedStatItem(prev => prev - 1);
                    }
                }
            };

            const addHeader = () => {
                setHeaders(prev => [...prev, `項目${prev.length + 1}`]);
                setStudents(prev => prev.map(s => ({
                    ...s,
                    grades: [...s.grades, ""]
                })));
            };

            const copyHeadersToClipboard = () => {
                const text = headers.join('\t');
                navigator.clipboard.writeText(text).then(() => {
                    alert("✅ 已複製項目名稱！\n\n您現在可以直接在 Excel 貼上作為表頭範本。");
                }).catch(err => {
                    console.error('Copy failed', err);
                    alert("複製失敗，請手動複製。");
                });
            };

            const handleRenameClass = () => {
                if (currentClassView === "All") return;
                
                const oldName = currentClassView;
                const newName = prompt(`請輸入「${oldName}」的新名稱：`, oldName);
                
                if (newName === null) return;

                const trimmedNewName = newName.trim();
                
                if (trimmedNewName === "") {
                    alert("班級名稱不能為空！");
                    return;
                }
                if (trimmedNewName === oldName) return;

                if (availableClasses.includes(trimmedNewName)) {
                    alert(`班級名稱「${trimmedNewName}」已存在，請使用不同名稱。`);
                    return;
                }

                if (window.confirm(`確定要將「${oldName}」更名為「${trimmedNewName}」嗎？\n該班級的所有學生資料將會自動更新。`)) {
                    setStudents(prev => prev.map(s => (s.className || "未分類") === oldName ? { ...s, className: trimmedNewName } : s));
                    setCustomClasses(prev => prev.map(c => c === oldName ? trimmedNewName : c));
                    setCurrentClassView(trimmedNewName);
                }
            };

            const handleDeleteClass = () => {
                if (currentClassView === "All") return;
                const count = students.filter(s => (s.className || "未分類") === currentClassView).length;
                if (window.confirm(count > 0 ? `確定刪除「${currentClassView}」？將刪除 ${count} 筆學生資料！` : `確定刪除「${currentClassView}」分頁？`)) {
                    setStudents(prev => prev.filter(s => (s.className || "未分類") !== currentClassView));
                    setCustomClasses(prev => prev.filter(c => c !== currentClassView));
                    setCurrentClassView("All");
                }
            };

            const removeStudent = (id) => {
                if(window.confirm("確定刪除這位學生？")) setStudents(prev => prev.filter(s => s.id !== id));
            };

            const updateStudentInfo = (id, field, value) => {
                setStudents(prev => prev.map(s => s.id === id ? { ...s, [field]: value } : s));
            };

            const updateGrade = (id, index, value) => {
                let numVal = value === "" ? "" : parseFloat(value);
                if (numVal !== "" && (numVal < 0 || numVal > 100)) return;
                setStudents(prev => prev.map(s => {
                    if (s.id === id) {
                        const newGrades = [...s.grades];
                        while (newGrades.length <= index) newGrades.push("");
                        newGrades[index] = numVal;
                        return { ...s, grades: newGrades };
                    }
                    return s;
                }));
            };

            const updateHeader = (index, value) => {
                const newHeaders = [...headers];
                newHeaders[index] = value;
                setHeaders(newHeaders);
            };

            const handleHeaderPaste = (e, startIndex) => {
                e.preventDefault();
                const clipboardData = e.clipboardData.getData('text');
                if (!clipboardData) return;
                const values = clipboardData.split(/\t|\n/).map(v => v.trim()).filter(v => v !== "");
                
                if (startIndex + values.length > headers.length) {
                    const columnsToAdd = (startIndex + values.length) - headers.length;
                    const additionalHeaders = Array(columnsToAdd).fill("").map((_, i) => `項目${headers.length + i + 1}`);
                    const updatedHeaders = [...headers, ...additionalHeaders];
                    const next = [...updatedHeaders];
                    values.forEach((val, i) => { next[startIndex + i] = val; });
                    setHeaders(next);
                    setStudents(prev => prev.map(s => ({
                         ...s,
                         grades: [...s.grades, ...Array(columnsToAdd).fill("")]
                    })));
                } else {
                    setHeaders(prev => {
                        const next = [...prev];
                        values.forEach((val, i) => { if (startIndex + i < next.length) next[startIndex + i] = val; });
                        return next;
                    });
                }
                setEditingHeader(null);
            };

            const handlePaste = (e, targetStudentId, startColType, startColIndex) => {
                e.preventDefault();
                const clipboardData = e.clipboardData.getData('text');
                if (!clipboardData) return;
                const rows = clipboardData.split(/\r\n|\n|\r/).filter(row => row.trim() !== '');
                if (rows.length === 0) return;
                const startStudentIndex = students.findIndex(s => s.id === targetStudentId);
                if (startStudentIndex === -1) return;

                setStudents(prev => {
                    let newStudents = [...prev];
                    let maxId = newStudents.length > 0 ? Math.max(...newStudents.map(s => s.id)) : 0;

                    rows.forEach((rowStr, rOffset) => {
                        const cells = rowStr.split('\t');
                        let currentTargetIndex = startStudentIndex + rOffset;
                        if (currentTargetIndex >= newStudents.length) {
                            maxId++;
                            const defaultClass = currentClassView !== "All" ? currentClassView : (newStudents.length > 0 ? newStudents[newStudents.length -1].className : "101");
                            newStudents.push({ id: maxId, className: defaultClass, number: "", name: "", grades: Array(headers.length).fill("") });
                        }
                        const student = { ...newStudents[currentTargetIndex], grades: [...newStudents[currentTargetIndex].grades] }; 
                        
                        while(student.grades.length < headers.length) student.grades.push("");

                        cells.forEach((cellData, cOffset) => {
                            let currentVal = cellData.trim();
                            let absoluteStartCol = (startColType === 'meta') ? startColIndex : (3 + startColIndex);
                            const currentAbsoluteCol = absoluteStartCol + cOffset;
                            if (currentAbsoluteCol === 0) student.className = currentVal;
                            else if (currentAbsoluteCol === 1) student.number = currentVal;
                            else if (currentAbsoluteCol === 2) student.name = currentVal;
                            else if (currentAbsoluteCol >= 3) {
                                const gradeIdx = currentAbsoluteCol - 3;
                                if (gradeIdx < headers.length) {
                                    let numVal = (currentVal === "" || isNaN(parseFloat(currentVal))) ? "" : parseFloat(currentVal);
                                    if (numVal !== "") { if (numVal < 0) numVal = 0; if (numVal > 100) numVal = 100; student.grades[gradeIdx] = numVal; }
                                }
                            }
                        });
                        newStudents[currentTargetIndex] = student;
                    });
                    return newStudents;
                });
            };

            const triggerFileUpload = () => fileInputRef.current.click();
            const handleFileImport = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (evt) => {
                    try {
                        const data = evt.target.result;
                        const workbook = XLSX.read(data, { type: 'binary' });
                        
                        let allNewStudents = [];
                        let globalHeadersSet = new Set(); // 用來收集所有分頁出現過的成績欄位名稱
                        let currentId = 1;

                        // 遍歷所有工作表 (Sheet)
                        workbook.SheetNames.forEach(sheetName => {
                            const sheet = workbook.Sheets[sheetName];
                            const jsonData = XLSX.utils.sheet_to_json(sheet, { header: 1 });
                            if (jsonData.length < 2) return; // 跳過空的工作表或是只有標題的

                            const fileHeaders = jsonData[0];
                            let classIdx = -1, numIdx = -1, nameIdx = -1;
                            const sheetGradeMap = []; // 用來記錄這個 Sheet 的成績欄位對應: [{ colIdx, headerText }]

                            // 解析這個 Sheet 的表頭
                            fileHeaders.forEach((h, colIdx) => {
                                const ht = String(h).trim();
                                if (ht === "班級" || ht === "Class") classIdx = colIdx;
                                else if (ht === "座號" || ht === "No" || ht === "No.") numIdx = colIdx;
                                else if (ht === "姓名" || ht === "Name") nameIdx = colIdx;
                                else if (ht) { // 其他視為成績欄位
                                    sheetGradeMap.push({ colIdx, headerText: ht });
                                    globalHeadersSet.add(ht); // 加入全域標題集合
                                }
                            });

                            // 解析每一列資料
                            for (let i = 1; i < jsonData.length; i++) {
                                const row = jsonData[i];
                                if (!row || row.length === 0) continue;

                                // 判斷班級名稱：優先使用欄位內的「班級」，若無則使用「工作表名稱」
                                let className = "";
                                if (classIdx !== -1 && row[classIdx]) {
                                    className = String(row[classIdx]).trim();
                                } else {
                                    className = sheetName.trim();
                                }

                                const studentTemp = {
                                    tempId: currentId++,
                                    className: className,
                                    number: numIdx !== -1 ? String(row[numIdx] || "").trim() : "",
                                    name: nameIdx !== -1 ? String(row[nameIdx] || "").trim() : "",
                                    gradesMap: {} // 先用物件暫存成績，方便最後整合： { "國文": 90, "英文": 80 }
                                };

                                // 讀取成績
                                sheetGradeMap.forEach(map => {
                                    const val = row[map.colIdx];
                                    let numVal = (val === undefined || val === null || val === "") ? "" : parseFloat(val);
                                    if (numVal !== "" && !isNaN(numVal)) {
                                        if (numVal < 0) numVal = 0;
                                        if (numVal > 100) numVal = 100;
                                        studentTemp.gradesMap[map.headerText] = numVal;
                                    }
                                });
                                
                                // 只有當有姓名或座號時才視為有效資料
                                if (studentTemp.name || studentTemp.number) {
                                    allNewStudents.push(studentTemp);
                                }
                            }
                        });

                        if (allNewStudents.length === 0) {
                            alert("Excel 中找不到有效的學生資料。");
                            return;
                        }

                        // 將 Set 轉為陣列，確認最終的所有欄位
                        const finalHeaders = Array.from(globalHeadersSet);
                        
                        // 將暫存的學生資料轉換為系統使用的陣列格式 [score1, score2, ...]
                        const finalStudents = allNewStudents.map(s => {
                            const gradeArray = finalHeaders.map(h => {
                                // 根據標題名稱去查找該學生的成績，如果該 Sheet 沒這個科目就留空
                                return s.gradesMap[h] !== undefined ? s.gradesMap[h] : "";
                            });
                            return {
                                id: s.tempId,
                                className: s.className,
                                number: s.number,
                                name: s.name,
                                grades: gradeArray
                            };
                        });

                        if (confirm(`準備匯入 ${finalStudents.length} 筆資料 (來自 ${workbook.SheetNames.length} 個工作表)。\n這將會覆蓋目前的資料並重設項目欄位，確定嗎？`)) {
                            setHeaders(finalHeaders.length > 0 ? finalHeaders : INITIAL_HEADERS);
                            setStudents(finalStudents);
                            setCustomClasses([]);
                            setCurrentClassView("All");
                            setSelectedStatItem(0);
                            alert("匯入成功！");
                        }
                    } catch (err) { 
                        console.error(err); 
                        alert("讀取失敗，請確認檔案格式是否正確。"); 
                    }
                    fileInputRef.current.value = "";
                };
                reader.readAsBinaryString(file);
            };

            const exportExcel = () => {
                if (students.length === 0) { alert("無資料可匯出"); return; }
                const wb = XLSX.utils.book_new();
                const classes = [...new Set(students.map(s => s.className || "未分類"))].sort();
                classes.forEach(cls => {
                    const wsData = students.filter(s => (s.className || "未分類") === cls).map(s => {
                        let row = { "班級": s.className, "座號": s.number, "姓名": s.name };
                        headers.forEach((h, idx) => { row[h] = s.grades[idx]; });
                        return row;
                    });
                    const ws = XLSX.utils.json_to_sheet(wsData);
                    ws['!cols'] = [{wch: 10}, {wch: 8}, {wch: 15}, ...headers.map(() => ({wch: 10}))];
                    XLSX.utils.book_append_sheet(wb, ws, cls.replace(/[\\/?*\[\]]/g, "_").substring(0, 31));
                });
                XLSX.writeFile(wb, `成績總表_${new Date().toISOString().slice(0,10)}.xlsx`);
            };

            const statsData = useMemo(() => {
                const safeIndex = selectedStatItem < headers.length ? selectedStatItem : 0;
                const currentHeaderName = headers[safeIndex] || "未知";
                
                const targetStudents = displayedStudents;
                const validGrades = targetStudents.map(s => s.grades[safeIndex]).filter(g => g !== "" && g !== null && g !== undefined);
                const total = validGrades.length;
                const avg = total > 0 ? (validGrades.reduce((a, b) => a + b, 0) / total).toFixed(1) : 0;
                const distribution = RANGES.map(range => {
                    const count = validGrades.filter(g => range.check(g)).length;
                    const percentage = total > 0 ? ((count / total) * 100).toFixed(1) : 0;
                    return { ...range, count, percentage };
                });
                return { total, avg, distribution, currentHeaderName, isFiltered: currentClassView !== "All" };
            }, [displayedStudents, selectedStatItem, headers, currentClassView]);

            if (isLoading) return <div className="loading-overlay"><div className="spinner"></div><div className="font-bold">資料讀取中...</div></div>;

            return (
                <div className="min-h-screen p-4 md:p-8 max-w-[1920px] mx-auto">
                    <input type="file" accept=".xlsx, .xls" ref={fileInputRef} style={{display: 'none'}} onChange={handleFileImport} />

                    <div className="bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg p-6 mb-6 border border-white/50 relative overflow-hidden">
                        {/* Header Background Decoration */}
                        <div className="absolute top-0 right-0 w-64 h-64 bg-yellow-100 rounded-full mix-blend-multiply filter blur-3xl opacity-50 -translate-y-1/2 translate-x-1/2 pointer-events-none"></div>
                        <div className="absolute bottom-0 left-0 w-64 h-64 bg-pink-100 rounded-full mix-blend-multiply filter blur-3xl opacity-50 translate-y-1/2 -translate-x-1/2 pointer-events-none"></div>

                        <div className="relative z-10 flex flex-col md:flex-row justify-between items-center gap-6">
                            <div>
                                <h1 className="text-3xl font-black text-gray-800 flex items-center tracking-tight">
                                    <span className="bg-clip-text text-transparent bg-gradient-to-r from-orange-500 to-rose-500 mr-2">
                                        <i className="fa-solid fa-graduation-cap"></i>
                                    </span>
                                    班級成績管理系統
                                </h1>
                                <p className="text-gray-500 font-medium mt-2 flex items-center gap-4 text-sm">
                                    <span className="flex items-center"><i className="fa-solid fa-cloud-arrow-up text-green-500 mr-1.5"></i>自動儲存</span>
                                    <span className="flex items-center"><i className="fa-solid fa-file-excel text-green-600 mr-1.5"></i>Excel 整合</span>
                                    <span className="flex items-center"><i className="fa-solid fa-keyboard text-purple-500 mr-1.5"></i>鍵盤導航</span>
                                </p>
                            </div>
                            <div className="flex gap-3 flex-wrap justify-center">
                                <button onClick={() => setActiveTab('input')} className={`px-6 py-2.5 rounded-full font-bold transition-all duration-300 shadow-sm flex items-center ${activeTab === 'input' ? 'bg-gradient-to-r from-orange-500 to-rose-500 text-white shadow-orange-200 shadow-lg scale-105' : 'bg-white text-gray-600 hover:bg-orange-50 border border-orange-100'}`}>
                                    <i className="fa-solid fa-pen-to-square mr-2"></i>成績輸入
                                </button>
                                <button onClick={() => setActiveTab('stats')} className={`px-6 py-2.5 rounded-full font-bold transition-all duration-300 shadow-sm flex items-center ${activeTab === 'stats' ? 'bg-gradient-to-r from-violet-500 to-fuchsia-500 text-white shadow-purple-200 shadow-lg scale-105' : 'bg-white text-gray-600 hover:bg-purple-50 border border-purple-100'}`}>
                                    <i className="fa-solid fa-chart-pie mr-2"></i>統計分析
                                </button>
                                <div className="w-px h-10 bg-gray-200 mx-2 hidden md:block"></div>
                                <button onClick={copyHeadersToClipboard} className="px-4 py-2 bg-blue-500 text-white rounded-lg font-bold hover:bg-blue-600 transition-colors shadow-md hover:shadow-lg flex items-center text-sm" title="複製項目名稱到剪貼簿 (Excel用)">
                                    <i className="fa-regular fa-copy mr-2"></i>複製項目
                                </button>
                                <button onClick={triggerFileUpload} className="px-4 py-2 bg-amber-500 text-white rounded-lg font-bold hover:bg-amber-600 transition-colors shadow-md hover:shadow-lg flex items-center text-sm">
                                    <i className="fa-solid fa-file-import mr-2"></i>匯入 Excel
                                </button>
                                <button onClick={exportExcel} className="px-4 py-2 bg-green-500 text-white rounded-lg font-bold hover:bg-green-600 transition-colors shadow-md hover:shadow-lg flex items-center text-sm">
                                    <i className="fa-solid fa-file-export mr-2"></i>匯出 Excel
                                </button>
                            </div>
                        </div>
                    </div>

                    {/* Class Tabs */}
                    <div className="flex items-center gap-2 mb-4 overflow-x-auto pb-2 scrollbar-hide">
                        <button 
                            onClick={() => setCurrentClassView("All")}
                            className={`px-4 py-2 rounded-t-lg font-bold transition-all whitespace-nowrap ${currentClassView === "All" ? "bg-white text-orange-600 border-t-2 border-orange-500 shadow-sm" : "bg-orange-50/50 text-gray-500 hover:bg-white"}`}
                        >
                            <i className="fa-solid fa-layer-group mr-2"></i>全部學生
                        </button>
                        {availableClasses.map(cls => (
                            <button 
                                key={cls}
                                onClick={() => setCurrentClassView(cls)}
                                onDoubleClick={handleRenameClass}
                                className={`px-4 py-2 rounded-t-lg font-bold transition-all whitespace-nowrap flex items-center gap-2 ${currentClassView === cls ? "bg-white text-orange-600 border-t-2 border-orange-500 shadow-sm" : "bg-orange-50/50 text-gray-500 hover:bg-white"}`}
                                title="雙擊可重新命名"
                            >
                                {cls}
                            </button>
                        ))}
                        <button onClick={handleAddClassTab} className="px-3 py-1 bg-orange-100 hover:bg-orange-200 text-orange-600 rounded-full text-sm transition-colors" title="新增班級分頁">
                            <i className="fa-solid fa-plus"></i>
                        </button>
                        <div className="flex-1"></div>
                        {currentClassView !== "All" && (
                            <button onClick={handleDeleteClass} className="text-red-400 hover:text-red-600 text-sm px-3 py-1 hover:bg-red-50 rounded transition">
                                <i className="fa-solid fa-trash-can mr-1"></i>刪除此班級
                            </button>
                        )}
                    </div>

                    {/* Main Content Area */}
                    <div className="bg-white rounded-b-2xl rounded-tr-2xl shadow-xl min-h-[600px] border-t border-orange-100 overflow-hidden relative">
                        {activeTab === 'input' ? (
                            <div className="flex flex-col h-full">
                                {displayedStudents.length === 0 ? (
                                    <EmptyState message="目前這個班級還沒有學生資料喔！" action={addStudent} actionText="新增第一位學生" />
                                ) : (
                                    <>
                                        <div className="overflow-auto flex-1 table-container max-h-[70vh]">
                                            <table className="w-full text-left border-collapse min-w-max">
                                                <thead className="bg-orange-50 sticky top-0 z-20 shadow-sm">
                                                    <tr>
                                                        <th className="p-3 w-16 text-center font-bold text-gray-600 border-b border-orange-200 sticky left-0 bg-orange-50 z-30">#</th>
                                                        <th className="p-3 w-20 font-bold text-gray-600 border-b border-orange-200 sticky left-16 bg-orange-50 z-30">班級</th>
                                                        <th className="p-3 w-20 font-bold text-gray-600 border-b border-orange-200 sticky left-36 bg-orange-50 z-30">座號</th>
                                                        <th className="p-3 w-32 font-bold text-gray-600 border-b border-orange-200 sticky left-56 bg-orange-50 z-30 border-r-2 border-r-orange-200">姓名</th>
                                                        {headers.map((h, idx) => (
                                                            <th key={idx} className="p-3 w-28 text-center font-bold text-gray-600 border-b border-orange-200 relative group">
                                                                <div className="flex items-center justify-center gap-1">
                                                                    {editingHeader === idx ? (
                                                                        <input 
                                                                            autoFocus
                                                                            type="text" 
                                                                            className="w-full text-center text-sm border-b-2 border-orange-400 outline-none bg-transparent"
                                                                            value={h}
                                                                            onBlur={() => setEditingHeader(null)}
                                                                            onKeyDown={(e) => { if(e.key === 'Enter') setEditingHeader(null); }}
                                                                            onChange={(e) => updateHeader(idx, e.target.value)}
                                                                            onPaste={(e) => handleHeaderPaste(e, idx)}
                                                                        />
                                                                    ) : (
                                                                        <span 
                                                                            onDoubleClick={() => setEditingHeader(idx)}
                                                                            className="cursor-pointer hover:text-orange-600 transition"
                                                                            title="雙擊可更名，在此貼上可批次修改標題"
                                                                        >
                                                                            {h}
                                                                        </span>
                                                                    )}
                                                                    <button 
                                                                        onClick={() => removeHeader(idx)}
                                                                        className="delete-col-btn absolute top-1 right-1 text-red-300 hover:text-red-500 bg-white rounded-full w-5 h-5 flex items-center justify-center shadow-sm"
                                                                        title="刪除此欄位"
                                                                    >
                                                                        &times;
                                                                    </button>
                                                                </div>
                                                            </th>
                                                        ))}
                                                        <th className="p-3 w-12 text-center border-b border-orange-200">
                                                            <button onClick={addHeader} className="text-orange-500 hover:text-orange-700 bg-orange-100 w-8 h-8 rounded-full flex items-center justify-center transition hover:scale-110">
                                                                <i className="fa-solid fa-plus"></i>
                                                            </button>
                                                        </th>
                                                    </tr>
                                                </thead>
                                                <tbody className="divide-y divide-gray-100">
                                                    {displayedStudents.map((s, rIndex) => (
                                                        <tr key={s.id} className="hover:bg-orange-50/30 transition-colors group">
                                                            <td className="p-2 text-center text-gray-400 text-xs font-mono sticky left-0 bg-white group-hover:bg-orange-50/30 z-10 border-r">{rIndex + 1}</td>
                                                            <td className="p-1 sticky left-16 bg-white group-hover:bg-orange-50/30 z-10 border-r">
                                                                <input 
                                                                    id={`cell-${rIndex}-0`}
                                                                    type="text" 
                                                                    value={s.className || ""} 
                                                                    onChange={(e) => updateStudentInfo(s.id, "className", e.target.value)}
                                                                    onKeyDown={(e) => handleKeyDown(e, rIndex, 0)}
                                                                    onPaste={(e) => handlePaste(e, s.id, 'meta', 0)}
                                                                    className="w-full p-2 text-sm text-center border-transparent bg-transparent hover:border-gray-200 focus:bg-white focus:border-orange-400 rounded outline-none transition"
                                                                    placeholder="班級"
                                                                />
                                                            </td>
                                                            <td className="p-1 sticky left-36 bg-white group-hover:bg-orange-50/30 z-10 border-r">
                                                                <input 
                                                                    id={`cell-${rIndex}-1`}
                                                                    type="text" 
                                                                    value={s.number || ""} 
                                                                    onChange={(e) => updateStudentInfo(s.id, "number", e.target.value)}
                                                                    onKeyDown={(e) => handleKeyDown(e, rIndex, 1)}
                                                                    onPaste={(e) => handlePaste(e, s.id, 'meta', 1)}
                                                                    className="w-full p-2 text-sm text-center border-transparent bg-transparent hover:border-gray-200 focus:bg-white focus:border-orange-400 rounded outline-none transition"
                                                                    placeholder="座號"
                                                                />
                                                            </td>
                                                            <td className="p-1 sticky left-56 bg-white group-hover:bg-orange-50/30 z-10 border-r-2 border-r-orange-100 shadow-[4px_0_4px_-2px_rgba(0,0,0,0.05)]">
                                                                <input 
                                                                    id={`cell-${rIndex}-2`}
                                                                    type="text" 
                                                                    value={s.name || ""} 
                                                                    onChange={(e) => updateStudentInfo(s.id, "name", e.target.value)}
                                                                    onKeyDown={(e) => handleKeyDown(e, rIndex, 2)}
                                                                    onPaste={(e) => handlePaste(e, s.id, 'meta', 2)}
                                                                    className="w-full p-2 text-sm border-transparent bg-transparent hover:border-gray-200 focus:bg-white focus:border-orange-400 rounded outline-none transition font-medium text-gray-700"
                                                                    placeholder="姓名"
                                                                />
                                                            </td>
                                                            {s.grades.map((g, idx) => (
                                                                <td key={idx} className="p-1 text-center relative">
                                                                    <input 
                                                                        id={`cell-${rIndex}-${3 + idx}`}
                                                                        type="number" 
                                                                        value={g} 
                                                                        onChange={(e) => updateGrade(s.id, idx, e.target.value)}
                                                                        onKeyDown={(e) => handleKeyDown(e, rIndex, 3 + idx)}
                                                                        onPaste={(e) => handlePaste(e, s.id, 'grade', idx)}
                                                                        className={`w-full p-2 text-center rounded outline-none font-mono text-gray-700 ${g === "" ? "empty-grade" : "bg-transparent hover:bg-white border border-transparent focus:border-blue-400 focus:bg-white"} ${g !== "" && parseFloat(g) < 60 ? "text-red-500 font-bold" : ""}`}
                                                                    />
                                                                </td>
                                                            ))}
                                                            <td className="p-2 text-center">
                                                                <button onClick={() => removeStudent(s.id)} className="text-gray-300 hover:text-red-500 transition opacity-0 group-hover:opacity-100" title="刪除學生">
                                                                    <i className="fa-solid fa-times"></i>
                                                                </button>
                                                            </td>
                                                        </tr>
                                                    ))}
                                                </tbody>
                                            </table>
                                        </div>
                                        <div className="p-4 bg-gray-50 border-t border-gray-100 flex justify-center sticky bottom-0 z-20">
                                            <button onClick={() => addStudent()} className="flex items-center gap-2 bg-white border border-gray-300 text-gray-600 hover:bg-orange-50 hover:text-orange-600 hover:border-orange-200 px-8 py-2 rounded-full shadow-sm transition-all transform hover:scale-105 active:scale-95">
                                                <i className="fa-solid fa-plus"></i> 新增下一位學生
                                            </button>
                                        </div>
                                    </>
                                )}
                            </div>
                        ) : (
                            <div className="p-8 bg-gradient-to-br from-white to-orange-50/30 h-full overflow-y-auto">
                                <div className="max-w-6xl mx-auto">
                                    <div className="flex items-center gap-4 mb-8">
                                        <label className="text-lg font-bold text-gray-700">選擇分析項目：</label>
                                        <div className="relative">
                                            <select 
                                                value={selectedStatItem} 
                                                onChange={(e) => setSelectedStatItem(parseInt(e.target.value))}
                                                className="appearance-none bg-white border-2 border-orange-200 text-gray-700 py-2 pl-4 pr-10 rounded-xl focus:outline-none focus:border-orange-500 focus:ring-4 focus:ring-orange-100 font-bold shadow-sm transition-all cursor-pointer"
                                            >
                                                {headers.map((h, i) => (
                                                    <option key={i} value={i}>{h}</option>
                                                ))}
                                            </select>
                                            <div className="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-orange-500">
                                                <i className="fa-solid fa-chevron-down text-sm"></i>
                                            </div>
                                        </div>
                                        {statsData.isFiltered && (
                                            <span className="bg-orange-100 text-orange-700 px-3 py-1 rounded-full text-sm font-bold">
                                                目前顯示：{currentClassView}
                                            </span>
                                        )}
                                    </div>

                                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10">
                                        <div className="bg-white p-6 rounded-2xl shadow-lg border border-orange-100 flex items-center gap-4 relative overflow-hidden group">
                                            <div className="absolute right-0 top-0 w-24 h-24 bg-blue-50 rounded-bl-full -mr-4 -mt-4 transition-all group-hover:scale-110"></div>
                                            <div className="w-16 h-16 rounded-2xl bg-blue-100 text-blue-500 flex items-center justify-center text-2xl relative z-10">
                                                <i className="fa-solid fa-users"></i>
                                            </div>
                                            <div>
                                                <p className="text-gray-500 font-medium mb-1">有效人數</p>
                                                <p className="text-4xl font-black text-gray-800">{statsData.total}</p>
                                            </div>
                                        </div>
                                        <div className="bg-white p-6 rounded-2xl shadow-lg border border-orange-100 flex items-center gap-4 relative overflow-hidden group">
                                            <div className="absolute right-0 top-0 w-24 h-24 bg-green-50 rounded-bl-full -mr-4 -mt-4 transition-all group-hover:scale-110"></div>
                                            <div className="w-16 h-16 rounded-2xl bg-green-100 text-green-500 flex items-center justify-center text-2xl relative z-10">
                                                <i className="fa-solid fa-chart-line"></i>
                                            </div>
                                            <div>
                                                <p className="text-gray-500 font-medium mb-1">平均分數</p>
                                                <p className={`text-4xl font-black ${parseFloat(statsData.avg) < 60 ? "text-red-500" : "text-gray-800"}`}>{statsData.avg}</p>
                                            </div>
                                        </div>
                                        <div className="bg-white p-6 rounded-2xl shadow-lg border border-orange-100 flex items-center gap-4 relative overflow-hidden group">
                                            <div className="absolute right-0 top-0 w-24 h-24 bg-purple-50 rounded-bl-full -mr-4 -mt-4 transition-all group-hover:scale-110"></div>
                                            <div className="w-16 h-16 rounded-2xl bg-purple-100 text-purple-500 flex items-center justify-center text-2xl relative z-10">
                                                <i className="fa-solid fa-percent"></i>
                                            </div>
                                            <div>
                                                <p className="text-gray-500 font-medium mb-1">及格率</p>
                                                <p className="text-4xl font-black text-gray-800">
                                                    {statsData.total > 0 ? (statsData.distribution.slice(0, 5).reduce((a, b) => a + b.count, 0) / statsData.total * 100).toFixed(0) : 0}%
                                                </p>
                                            </div>
                                        </div>
                                    </div>

                                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                                        <div className="bg-white p-8 rounded-3xl shadow-lg border border-gray-100">
                                            <h3 className="text-xl font-bold text-gray-800 mb-6 flex items-center">
                                                <i className="fa-solid fa-chart-simple mr-2 text-orange-500"></i>
                                                分數分佈
                                            </h3>
                                            <div className="space-y-4">
                                                {statsData.distribution.map((d, i) => (
                                                    <div key={i} className="relative">
                                                        <div className="flex justify-between text-sm mb-1 font-bold text-gray-600">
                                                            <span>{d.label}</span>
                                                            <span>{d.count} 人 ({d.percentage}%)</span>
                                                        </div>
                                                        <div className="h-4 bg-gray-100 rounded-full overflow-hidden">
                                                            <div 
                                                                className={`h-full ${d.color} transition-all duration-1000 ease-out`} 
                                                                style={{width: `${d.percentage}%`}}
                                                            ></div>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>

                                        <div className="bg-white p-8 rounded-3xl shadow-lg border border-gray-100">
                                            <h3 className="text-xl font-bold text-gray-800 mb-6 flex items-center">
                                                <i className="fa-solid fa-trophy mr-2 text-yellow-500"></i>
                                                班級排行榜 ({statsData.currentHeaderName})
                                            </h3>
                                            {classRankings.length > 0 ? (
                                                <div className="space-y-3">
                                                    {classRankings.map((cls, idx) => (
                                                        <div key={cls.className} className={`rank-card flex items-center justify-between p-4 rounded-xl ${idx === 0 ? 'rank-1' : idx === 1 ? 'rank-2' : idx === 2 ? 'rank-3' : 'bg-gray-50 border border-gray-200'}`}>
                                                            <div className="flex items-center gap-4">
                                                                <div className={`w-10 h-10 rounded-full flex items-center justify-center font-black text-lg ${idx === 0 ? 'bg-yellow-400 text-white shadow-md' : idx === 1 ? 'bg-slate-400 text-white' : idx === 2 ? 'bg-orange-400 text-white' : 'bg-gray-200 text-gray-500'}`}>
                                                                    {idx + 1}
                                                                </div>
                                                                <div>
                                                                    <p className="font-bold text-gray-800 text-lg">{cls.className}</p>
                                                                    <p className="text-xs text-gray-500 font-medium">{cls.count} 位學生</p>
                                                                </div>
                                                            </div>
                                                            <div className="flex items-center gap-2">
                                                                {idx === 0 && <i className="fa-solid fa-crown text-yellow-500 text-xl crown-icon"></i>}
                                                                <span className="font-mono font-bold text-2xl text-gray-800">{cls.avg}</span>
                                                                <span className="text-xs text-gray-400 font-bold mt-2">分</span>
                                                            </div>
                                                        </div>
                                                    ))}
                                                </div>
                                            ) : (
                                                <div className="h-40 flex flex-col items-center justify-center text-gray-400">
                                                    <i className="fa-regular fa-folder-open text-4xl mb-2 opacity-50"></i>
                                                    <p>尚無足夠數據進行排名</p>
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>